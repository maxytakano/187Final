/*!CK:3895877357!*//*1418226189,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["63xuo"]); }

__d("createIxElement",["DOM","invariant","joinClasses"],function(a,b,c,d,e,f,g,h,i){function j(k,l){var m='img',n;h(k.sprited||k.uri);if(k.sprited){m=i(m,k.spriteMapCssClass,k.spriteCssClass);n=g.create('i',{className:m});if(l!=null)g.setContent(n,g.create('u',null,l));}else if(k.uri){n=g.create('img',{className:m,src:k.uri});if(l!=null)n.setAttribute('alt',l);if(k.width)n.setAttribute('width',k.width);if(k.height)n.setAttribute('height',k.height);}return n;}e.exports=j;},null);
__d("PhotoAlbumAudienceInput",["Arbiter","CSS","DOM","Event"],function(a,b,c,d,e,f,g,h,i,j){function k(l,m,n,o,p){"use strict";this.$PhotoAlbumAudienceInput0=l;if(m){this.$PhotoAlbumAudienceInput1=m;this.$PhotoAlbumAudienceInput2=n;this.$PhotoAlbumAudienceInput3=o;this.$PhotoAlbumAudienceInput4=p;g.subscribe('Tokenizer/init',this.$PhotoAlbumAudienceInput5.bind(this));j.listen(this.$PhotoAlbumAudienceInput3,'click',this.$PhotoAlbumAudienceInput6.bind(this));}}k.prototype.removeHiddenPrivacyWidget=function(){"use strict";[this.$PhotoAlbumAudienceInput0,this.$PhotoAlbumAudienceInput1,this.$PhotoAlbumAudienceInput4].forEach(function(l){if(l&&h.hasClass(l,'hidden_elem'))i.remove(l);});};k.prototype.$PhotoAlbumAudienceInput6=function(){"use strict";this.$PhotoAlbumAudienceInput7.removeAllTokens();this.$PhotoAlbumAudienceInput8(null,null);};k.prototype.$PhotoAlbumAudienceInput5=function(l,m){"use strict";if(this.$PhotoAlbumAudienceInput7||this.$PhotoAlbumAudienceInput2!=m.element)return;this.$PhotoAlbumAudienceInput7=m;this.$PhotoAlbumAudienceInput8(null,null);g.subscribe('Form/change',this.$PhotoAlbumAudienceInput8.bind(this));};k.prototype.$PhotoAlbumAudienceInput8=function(l,m){"use strict";var n=this.$PhotoAlbumAudienceInput7.getTokens().length>0;this.$PhotoAlbumAudienceInputa(n);};k.prototype.$PhotoAlbumAudienceInputa=function(l){"use strict";h.conditionShow(this.$PhotoAlbumAudienceInput1,l);h.conditionShow(this.$PhotoAlbumAudienceInput0,!l);this.$PhotoAlbumAudienceInput4&&h.conditionShow(this.$PhotoAlbumAudienceInput4,l);};e.exports=k;},null);
__d("PhotoAlbumPlacesTypeahead",["Arbiter"],function(a,b,c,d,e,f,g){function h(i){"use strict";if(!i)return;if(i.getCore().getHiddenValue()){var j={uid:i.getCore().getHiddenValue(),text:i.getCore().getValue()};g.inform('PhotoAlbumPlacesTypeahead.EXIST_PLACE',j);}i.subscribe('select',function(k,l){g.inform('PhotoAlbumPlacesTypeahead.SELECTED_PLACE',l.selected);}.bind(this));i.subscribe('reset',function(){if(!i.getCore().getHiddenValue())g.inform('PhotoAlbumPlacesTypeahead.RESET_PLACE');}.bind(this));i.subscribe('focus',function(){g.inform('PhotoAlbumPlacesTypeahead.FOCUSED');}.bind(this));this._initialized=true;}h.prototype.init=function(i){"use strict";if(this._initialized)return;h.call(this,i);};e.exports=h;},null);
__d("PersistentAlbumDataStore",["WebStorage"],function(a,b,c,d,e,f,g){var h='fb_album_recovery',i=7*60*60*24,j={_storageExists:true,_initializeWebStorage:function(){var k=g.getLocalStorage();if(!k){j._storageExists=false;return;}if(!k.getItem(h))k.setItem(h,JSON.stringify({}));},_getAlbumsObject:function(){if(!j._storageExists)return {};j._initializeWebStorage();return JSON.parse(g.getLocalStorage().getItem(h));},_setAlbumsObject:function(k){if(!j._storageExists)return;j._initializeWebStorage();g.getLocalStorage().setItem(h,JSON.stringify(k));},_getLocalStorageByAlbum:function(k){return (j._getAlbumsObject()[k]||j.createAlbum(k));},_setLocalStorageByAlbum:function(k,l){var m=j._getAlbumsObject();m[k]=l;j._setAlbumsObject(m);},createAlbum:function(k){var l={privacy:null,tags:{},created_at:Date.now()};j._setLocalStorageByAlbum(k,l);return l;},deleteAlbum:function(k){var l=j._getAlbumsObject();delete l[k];j._setAlbumsObject(l);},getAlbumPrivacy:function(k){return j._getLocalStorageByAlbum(k).privacy;},setAlbumPrivacy:function(k,l){var m=j._getLocalStorageByAlbum(k);m.privacy=l;j._setLocalStorageByAlbum(k,m);},saveTag:function(k,l,m){var n=j._getLocalStorageByAlbum(k);if(!n.tags[l])n.tags[l]=[];m.recovered=true;n.tags[l].push(m);j._setLocalStorageByAlbum(k,n);},removeTag:function(k,l,m){var n=j._getLocalStorageByAlbum(k),o=n.tags[l]||[];for(var p=0;p<o.length;p++)if(o[p].subject===m||o[p].name===m){o.splice(p,1);break;}n.tags[l]=o;j._setLocalStorageByAlbum(k,n);},getTags:function(k,l){return (j._getLocalStorageByAlbum(k).tags[l]||[]);},deleteExpiredAlbums:function(){var k=j._getAlbumsObject();for(var l in k){var m=k[l];if(Date.now()-m.created_at>i*1000)j.deleteAlbum(l);}}};e.exports=j;},null);
__d("PhotoBulkEditTagger",["Arbiter","AsyncRequest","CSS","DOM","DOMQuery","Event","FaceboxSourceConstants","Parent","PersistentAlbumDataStore","PhotosConst","PhotosTaggingWaterfall","PhotoTagger","PhotoTagStore","SubscriptionsHandler","Vector","$","copyProperties","csx","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){var z=60;for(var aa in r)if(r.hasOwnProperty(aa))ca[aa]=r[aa];var ba=r===null?null:r.prototype;ca.prototype=Object.create(ba);ca.prototype.constructor=ca;ca.__superConstructor__=r;function ca(da,ea,fa,ga){"use strict";r.call(this,da);this.editor=da;this.faceboxes=[];this.gkEnableTagNext=ga.gkEnableTagNext;this._qn=ga.qn;this.tokenizer=fa;this.editor.registerTagger(this);this.typeahead=fa.getTypeahead();this.handlers=new t();this.root=this.editor.getRoot();this.tagger=ea;this.hideNewTagTimer=null;this.photoKey=null;this._needTaggingData=true;this._currentRecognition={box:null,isTagged:false,suggestion:null};this._hoverState=false;this._tagging=false;this.setupHandlers();this._sendWaterfallLogSignal(q.BEGIN);this.fetchTaggingSuggestions();this.setTagAccumulator(ga.bulkSaveTags);this.setNeedTaggingData(ga.needTaggingData);this.version=p.BULK_EDITOR;l.listen(this.root,'mousemove',function(event){var ha=event.getTarget();if(this._hoverState&&!(n.byClass(ha,'faceBox')||n.byClass(ha,'tagPointer')||n.byClass(ha,'arrow')||n.byClass(ha,'faceboxSuggestion'))){this.removeSuggestionFromTagger();this.hideTagger();}}.bind(this));}ca.prototype.setupUserActionLogging=function(){"use strict";return null;};ca.prototype.logUserActionEvent=function(da){"use strict";return null;};ca.prototype.addFaceboxes=function(da){"use strict";this.faceboxes=k.scry(da.parentNode,'.faceBox');this.faceboxes.sort(function(ha,ia){return ha.offsetLeft===ia.offsetLeft?ha.offsetTop-ia.offsetTop:ha.offsetLeft-ia.offsetLeft;});var ea=n.byClass(da,'editablePhoto'),fa=s.getInstance().getPhotoTags(ea.getAttribute('data-photoid')),ga=[];Object.keys(fa).forEach(function(ha){if(fa[ha].fbid)ga[fa[ha].fbid]=true;});this.faceboxes.forEach(function(ha){var ia=this.getFaceboxSuggestionFromFaceboxElem(ha),ja=ha.getAttribute('data-faceboxid');if((ia&&fa[ia.getAttribute('data-id')])||ga[ja]){j.remove(ha);return;}var ka={image:da,facebox:ha};l.listen(ha,'mouseenter',this._mouseOverFacebox.bind(this,ka));}.bind(this));};ca.prototype.saveTag=function(da,ea,fa){"use strict";if(!ea.info.recovered){ba.saveTag.call(this,da,ea,fa);var ga=this.getTaggingDataForSave(ea,fa);o.saveTag(this.photoData.albumFBID,this.photoData.fbid,ga);}g.inform('PhotoBulkEditTagger.TAG_SAVED',{editor:this.root,fbid:this.photoData.fbid});};ca.prototype.recoverPhoto=function(da){"use strict";this.setupPhotoDataForTarget(da.getRoot());var ea=o.getTags(this.photoData.albumFBID,this.photoData.fbid);ea.forEach(function(fa){var ga=this.tokenizer.createToken({uid:fa.subject?fa.subject:fa.name,text:fa.name,suggestion:fa.from_facebox,freeform:(fa.subject===''),recovered:true});this.tokenizer.addToken(ga);s.getInstance().storeTagWithOptions(this.photoData.fbid,fa.subject,fa.x,fa.y,fa);}.bind(this));};ca.prototype.setNeedTaggingData=function(da){"use strict";this._needTaggingData=da;return this;};ca.prototype.setTagAccumulator=function(da){"use strict";ba.setTagAccumulator.call(this,da);return this;};ca.prototype.needTaggingData=function(){"use strict";return this._needTaggingData;};ca.prototype.setupHandlers=function(){"use strict";l.listen(this.root,'click',this.clickHandler.bind(this));this.tokenizer.subscribe(['addToken','removeToken'],this.handleTokenAction.bind(this));this.tokenizer.subscribe('switchTarget',this.switchPhoto.bind(this));this.tokenizer.subscribe('initialized',this.editor._recoverPhotos.bind(this.editor));g.subscribe('PhotoBulkEditTagger.DATA_SOURCE_READY',this.useTaggingDataSource.bind(this));g.subscribe(this.editor.mapEventNameToNamespace('PhotosBulkEditor.PHOTO_REORDER_START'),this.hideTagger.bind(this));};ca.prototype.hideTagger=function(){"use strict";ba.hideTagger.apply(this,arguments);if(this._currentRecognition.box&&!this._currentRecognition.isTagged)i.show(this._currentRecognition.box);this._tagging=false;this._hoverState=false;this._currentRecognition.box=null;this._currentRecognition.isTagged=false;this._currentRecognition.suggestion=null;this.recognizedUsers=[];};ca.prototype.done=function(){"use strict";this._sendWaterfallLogSignal(q.FINISH);};ca.prototype.handleTokenAction=function(da,ea){"use strict";var fa=v(this.photoKey),ga=j.find(fa,'.peopleIcon'),ha=j.find(fa,'.editablePhotoTagList'),ia=j.find(ga,'.count'),ja=this.tokenizer.getTokens().length,ka=ea.info.suggestion?m.UPLOADER_SUGGEST:null;if(this._currentRecognition.box)this._currentRecognition.isTagged=!!ja;i.conditionClass(ga,'hasPeople',!!ja);i.conditionClass(ha,'hasPeople',!!ja);j.setContent(ia,ja);if(da=='addToken'){this.saveTag(da,ea,ka);if(!this.gkEnableTagNext)return;for(var la=0;la<this.faceboxes.length;la++)if(i.shown(this.faceboxes[la])){setTimeout(function(){this.showTaggerByFacebox(this.faceboxes[la]);}.bind(this),100);break;}}else{this.removeTag(da,ea);o.removeTag(this.photoData.albumFBID,this.photoData.fbid,ea.info.uid);g.inform('PhotoBulkEditTagger.TAG_REMOVED',{editor:this.root,fbid:this.photoData.fbid});}};ca.prototype.useTaggingDataSource=function(da,ea){"use strict";if(!this._needTaggingData)return;var fa=this.tokenizer.getTypeahead();fa.swapData(ea);this.setNeedTaggingData(false);};ca.prototype.getTaggerPositioningOrigin=function(){"use strict";return u.getElementPosition(this.root);};ca.prototype.showTaggerByFacebox=function(da){"use strict";var ea=n.byClass(da,'faceBox');if(!ea)ea=n.byClass(da,'recognitionBox');this._currentRecognition.box=ea;var fa=n.byClass(da,'editablePhotoImage');this.setupPhotoDataForTarget(fa);var ga=j.find(fa,'.scaledImage img'),ha=null,ia=null,ja=null,ka=this.getRecognitionBoxCenter(ea,ga);ha=ka.boxPos;ia=ka.boxDim;ja=ka.taggerPos;i.hide(this._currentRecognition.box);this.recognizedUsers=JSON.parse(ea.getAttribute('data-recognizeduids'));this.setUpTagger(ga,fa,ha,ia,ja);};ca.prototype.getRecognitionBoxCenter=function(da,ea){"use strict";var fa=u.getElementPosition(da).add(u.getElementDimensions(da).mul(.5)),ga=u.getElementDimensions(this._currentRecognition.box),ha=this.calcTaggerPosition(ea,fa,ga.x,ga.y);return {boxPos:fa,boxDim:ga,taggerPos:ha};};ca.prototype.setUpTagger=function(da,ea,fa,ga,ha){"use strict";this.calcClickPoint(da,fa);ha.setElementPosition(this.tagger);if(ga)ga.setElementDimensions(this.tagger);i.hide(j.find(ea,'.clickToTagMessage'));this._sendWaterfallLogSignal(q.TAG_FACE);this.updateTypeaheadSuggestions();this.updateWithSuggestions();this.showTagger();this._tagging=true;};ca.prototype.clickHandler=function(event){"use strict";var da=event.getTarget();if(n.byClass(da,'photoTagTypeahead'))return;if(this._hoverState){this._hoverState=false;this._tagging=true;return;}if(this.tagger){this.hideTagger();this.removeSuggestionFromTagger();this.handlers.release();}if(n.byClass(da,'photoContextualSelector')||n.byClass(da,'removePhotoButton'))return;var ea=n.byClass(da,'editablePhotoImage');if(!ea){var fa=n.byClass(da,'peopleIcon');if(fa)this.setupPhotoDataForTarget(fa);return;}this.setupPhotoDataForTarget(ea);var ga=j.find(ea,'.scaledImage img'),ha=null,ia=null,ja=null,ka=n.byClass(da,'faceBox');if(!ka)ka=n.byClass(da,'recognitionBox');this._currentRecognition.box=ka;if(this._currentRecognition.box&&i.shown(this._currentRecognition.box)){var la=this.getRecognitionBoxCenter(ka,ga);ha=la.boxPos;ia=la.boxDim;ja=la.taggerPos;i.hide(this._currentRecognition.box);this._currentRecognition.isTagged=false;var ma=this.getFaceboxSuggestionFromFaceboxElem(ka);if(ma){this._currentRecognition.suggestion=ma;this.addSuggestionToTagger(ka,ma);this._sendFaceboxSuggestionLogSignal(ma.getAttribute('data-id'),m.UPLOADER_SUGGEST);}else this.recognizedUsers=JSON.parse(ka.getAttribute('data-recognizeduids'));}if(ja===null){ha=u.getEventPosition(event);ja=this.calcTaggerPosition(ga,ha,z);}if(!ja)return;this.setUpTagger(ga,ea,ha,ia,ja);};ca.prototype._mouseOverFacebox=function(da){"use strict";if(this._tagging)return;var ea=da.image,fa=da.facebox,ga=this.getFaceboxSuggestionFromFaceboxElem(fa);if(ga){this._hoverState=true;this._currentRecognition.box=fa;this._currentRecognition.suggestion=ga;this.setupPhotoDataForTarget(ea);this.addSuggestionToTagger(fa,ga);this._sendFaceboxSuggestionLogSignal(ga.getAttribute('data-id'),m.UPLOADER_SUGGEST);this._sendWaterfallLogSignal(q.HOVER_TAG_FACE);var ha=u.getElementPosition(fa).add(u.getElementDimensions(fa).mul(.5)),ia=u.getElementDimensions(this._currentRecognition.box),ja=this.calcTaggerPosition(ea,ha,ia.x,ia.y);this.calcClickPoint(ea,ha);ja.setElementPosition(this.tagger);ia.setElementDimensions(this.tagger);this.showTagger();}};ca.prototype.fetchTaggingSuggestions=function(){"use strict";this.logUserActionEvent('sugg_fetch');new h().setURI(this.ajaxURIs.tagsInit).setData({owner:this.photoData.owner}).setOption('retries',1).setHandler(function(da){var ea=da.getPayload();this.featuredSuggestions=ea.featuredTaggees;this.friendSuggestions=ea.friendTaggees;this.logUserActionEvent('sugg_fetch_done');}.bind(this)).send();};ca.prototype.switchPhoto=function(da,ea){"use strict";var fa=y(ea);fa&&this.setupPhotoDataForTarget(fa);this.hideTagger();};ca.prototype.getImageByID=function(da){"use strict";return y('editablePhoto_'+da);};ca.prototype.setupPhotoDataForTarget=function(da){"use strict";var ea;if(da&&!i.hasClass(da,'editablePhoto')){ea=n.byClass(da,'editablePhoto');}else ea=da;if(!ea){this.photoKey=null;this.photoData=null;return false;}var fa=ea.id;if(fa===this.photoKey)return;this.photoKey=fa;this.photoData=this.editor.getPhotoData(fa);this.tokenizer.setTokenarea(j.find(ea,'div.editablePhotoTagList'));};ca.prototype.getPosition=function(){"use strict";return this.photoData.fbid;};ca.prototype.tagsChangeHandler=function(da){"use strict";};ca.prototype.removeTagByID=function(da,ea,fa){"use strict";this.hideTagger();this.setupPhotoDataForTarget(this.getImageByID(da));ba.removeTagByID.call(this,da,ea,fa);};ca.prototype.setupFaceboxSuggestionHandlers=function(da,ea){"use strict";var fa=j.find(ea,"._570w"),ga=j.find(ea,"._570x");this.handlers.engage();this.handlers.addSubscriptions(l.listen(fa,'click',function(ha){this.dismissFaceboxSuggestion(da.id.replace('face:',''),ea.getAttribute('data-id'),this.photoData.owner,m.UPLOADER_DISMISS);this.removeSuggestionFromTagger();this.hideTagger();j.remove(this.getFaceboxSuggestionFromFaceboxElem(da));}.bind(this)),l.listen(ga,'click',function(ha){var ia=this.tokenizer.createToken({uid:ea.getAttribute('data-id'),text:ea.getAttribute('data-text'),suggestion:true});this.removeSuggestionFromTagger();i.hide(da);this.tokenizer.addToken(ia);}.bind(this)));};w(ca.prototype,{elemNames:{}});e.exports=ca;},null);
__d("PhotosBulkBackdateEditor",["Event","Arbiter","DOMQuery","Focus","Form"],function(a,b,c,d,e,f,g,h,i,j,k){var l={setup:function(m,n){g.listen(m,'click',function(){n.setContext(m);n.show();});var o=i.find(n.getContent(),"^.photosBulkDatePicker .saveBackdatedTime");g.listen(o,'click',function(){var p=k.serialize(n.getContent()),q=p.backdated_date,r=parseInt(p.use_date_from_file,10)>0,s=i.scry(n.getContent(),'#hide_from_newsfeed')[0],t=s&&s.checked;h.inform('PhotosBulkBackdateEditor.SAVED',{context:m,backdatedDate:q,hideFromNewsfeed:t,useDateFromFile:r});n.hide();j.set(m);});}};e.exports=l;},null);
__d("PhotoBulkEditTokenizer",["DOM","Event","Input","Parent","Tokenizer","UserAgent_DEPRECATED","getObjectValues"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){for(var n in k)if(k.hasOwnProperty(n))p[n]=k[n];var o=k===null?null:k.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=k;function p(){"use strict";if(k!==null)k.apply(this,arguments);}p.prototype.init=function(q,r,s,t){"use strict";this._tokenareaListeners={};o.init.call(this,q,r,s,t);this.inform('initialized');};p.prototype.initEvents=function(){"use strict";var q=l.firefox()<4?'keypress':'keydown';h.listen(this.input,'paste',this.paste.bind(this));h.listen(this.input,q,this.keydown.bind(this));};p.prototype.setTokenarea=function(q){"use strict";this.tokenarea=q;this.addTokenareaListener(q);this.reset();};p.prototype.addTokenareaListener=function(q){"use strict";if(this._tokenareaListeners[q.id])return;var r=this.handleEvents.bind(this);this._tokenareaListeners[q.id]=m(h.listen(q,{click:r,keydown:r}));};p.prototype.handleEvents=function(event){"use strict";var q=j.byClass(event.getTarget(),'editablePhotoTagList');if(!q){return;}else if(this.tokenarea!==q){this.setTokenarea(q);this.inform('switchTarget',this.tokenarea.id);}return o.handleEvents.call(this,event);};p.prototype.reset=function(){"use strict";var q=this.getTokenElements().map(function(r){return {uid:g.scry(r,'input')[0].value,text:g.scry(r,'input')[1].value};});i.reset(this.input);return o.reset.call(this,q);};p.prototype.updateTokenareaVisibility=function(){"use strict";return null;};p.prototype.insertToken=function(q){"use strict";g.prependContent(this.tokenarea,q.getElement());};e.exports=p;},null);
__d("ProgressiveDatepicker",["Arbiter","ArbiterMixin","CSS","DataStore","DOM","Event","Parent","copyProperties","getElementText","mixin","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(x){return new Date(x[0],x[1],x[2],x[3],x[4]);}function s(x,y){while(x.length)k.insertAfter(y,x.pop());}var t=p(h);for(var u in t)if(t.hasOwnProperty(u))w[u]=t[u];var v=t===null?null:t.prototype;w.prototype=Object.create(v);w.prototype.constructor=w;w.__superConstructor__=t;function w(x,y){"use strict";this._root=x;this._savedLabels={};this._savedPeriodsBack=[];this._savedPeriodsFront=[];this._menus={};var z=0;if(y.gmtoffset!==(void 0))z=-(new Date()).getTimezoneOffset()-y.gmtoffset;this._mintime=y.mintime&&new Date(1000*y.mintime-z*60000);this._maxtime=y.maxtime&&new Date(1000*y.maxtime-z*60000);j.set(x,'datepicker',this);k.scry(x,'select').forEach(function(aa){l.listen(aa,'change',q(this._handleChange,this,aa));var ba=m.byClass(aa,'period');l.listen(aa,'focus',i.addClass.bind(null,ba,'periodFocus'));l.listen(aa,'blur',i.removeClass.bind(null,ba,'periodFocus'));this._setMenuSelectionState(aa);if(aa.getAttribute('data-name')==='month')this._filterInvalidDates();}.bind(this));k.scry(x,'a.periodLabel').forEach(function(aa){var ba=m.byClass(aa,'period');l.listen(aa,'click',function(){i.addClass(ba,'periodSelected');i.addClass(ba,'periodFocus');});});this._filterInvalidDates();this.inform('initialized',this,g.BEHAVIOR_STATE);}w.prototype.setDate=function(x,y,z,aa,ba){"use strict";this._addSavedPeriods();var ca=w.PERIODS;for(var da=0;da<ca.length;da++)this._setValueForPeriod(ca[da],arguments[da]);this._filterInvalidDates();this.inform('changed');};w.prototype.setDateWithTimestamp=function(x){"use strict";var y=new Date(x);this.setDate(y.getFullYear(),y.getMonth()+1,y.getDate(),y.getHours(),y.getMinutes());};w.prototype.isSet=function(){"use strict";var x=w.PERIODS;for(var y=0;y<x.length;y++)if(this._getValueForPeriod(x[y]))return true;return false;};w.prototype.getRoot=function(){"use strict";return this._root;};w.prototype.getValues=function(){"use strict";var x=w.PERIODS,y={};for(var z=0;z<x.length;z++){var aa=this._getValueForPeriod(x[z]);if(aa)y[x[z]]=aa;}return y;};w.prototype.getDate=function(){"use strict";var x=this.getValues();return new Date(x.year||0,(x.month||1)-1,x.day||1,x.hour||0,x.minute||0);};w.prototype.getTimestamp=function(){"use strict";return Math.round(this.getDate().getTime()/1000);};w.prototype._setValueForPeriod=function(x,y){"use strict";var z=this._menuForPeriodName(x);if(!z)return;if(y===(void 0))y='';var aa=z.options;for(var ba=0,ca=aa.length;ba<ca;ba++)if(aa[ba].value==y){z.selectedIndex=ba;break;}this._setMenuSelectionState(z);};w.prototype._getValueForPeriod=function(x){"use strict";var y=this._menuForPeriodName(x);return (y&&y.options[y.selectedIndex].value);};w.prototype._handleChange=function(x){"use strict";this._setMenuSelectionState(x);this._filterInvalidDates();this.inform('changed');};w.prototype._setMenuSelectionState=function(x){"use strict";var y=m.byClass(x,'period');if(!y)return;if(i.hasClass(y,'periodRequired')){if(x.selectedIndex===0)x.selectedIndex=1;}else this._updateLabel(x);var z=x.getAttribute('data-name'),aa=x.options[x.selectedIndex].value;i.conditionClass(y,'periodSelected',aa);i.conditionClass(this._root,this._selectedClass(z),aa);if(!aa)this._resetMenu(w.PERIODS.indexOf(z)+1);};w.prototype._updateLabel=function(x){"use strict";var y=x.getAttribute('data-name'),z=x.options[0];if(!this._savedLabels[y])this._savedLabels[y]=o(z);if(x.selectedIndex===0){k.setContent(z,this._savedLabels[y]);}else k.setContent(z,'--');};w.prototype._daysInMonth=function(x,y){"use strict";return new Date(x||1999,y+1||1,0).getDate();};w.prototype._daysInCurrentMonth=function(){"use strict";return this._daysInMonth(this._getValueForPeriod('year'),this._getValueForPeriod('month')-1);};w.prototype._menuForPeriodName=function(x){"use strict";if(!this._menus[x])this._menus[x]=k.scry(this._root,'.'+x+'Menu')[0];return this._menus[x];};w.prototype._selectedClass=function(x){"use strict";return 'uiProgressiveDatepickerSelected-'+x;};w.prototype._resetMenu=function(x){"use strict";var y=w.PERIODS;for(;x<y.length;x++){var z=y[x],aa=this._menuForPeriodName(z);if(!aa)return;if(m.byClass(aa,'periodRequired')){aa.selectedIndex=1;}else{i.removeClass(m.byClass(aa,'period'),'periodSelected');i.removeClass(this._root,this._selectedClass(z));aa.selectedIndex=0;this._updateLabel(aa);}}};w.prototype._addSavedPeriods=function(){"use strict";var x=w.PERIODS;for(var y=0;y<x.length;y++){var z=this._menuForPeriodName(x[y]);if(!z)return;this._savedPeriodsFront[y]||(this._savedPeriodsFront[y]=[]);this._savedPeriodsBack[y]||(this._savedPeriodsBack[y]=[]);var aa=z.options[0],ba=z.options[z.options.length-1];if(y===w.PERIODS.indexOf('hour')||y===w.PERIODS.indexOf('minute')){s(this._savedPeriodsFront[y],aa);s(this._savedPeriodsBack[y],ba);}else{s(this._savedPeriodsBack[y],aa);s(this._savedPeriodsFront[y],ba);}}};w.prototype._filterInvalidDates=function(){"use strict";this._addSavedPeriods();var x=w.PERIODS,y=this.getValues();for(var z=0;z<x.length;z++){var aa=this._menuForPeriodName(x[z]);if(!aa)return;this._savedPeriodsFront[z]||(this._savedPeriodsFront[z]=[]);this._savedPeriodsBack[z]||(this._savedPeriodsBack[z]=[]);for(var ba=1;ba<aa.options.length;){var ca=aa.options[ba],da=[((z-1>=0)?y[x[0]]:0),((z-1>=1)?y[x[1]]-1:0),((z-1>=2)?y[x[2]]:1),((z-1>=3)?y[x[3]]:0),((z-1>=4)?y[x[4]]:0)];da[z]=ca.value;if(z===w.PERIODS.indexOf('month'))da[z]=da[z]-1;var ea=r(da),fa=[((z-1>=0)?y[x[0]]:9001),((z-1>=1)?y[x[1]]-1:11),((z-1>=2)?y[x[2]]:this._daysInCurrentMonth()),((z-1>=3)?y[x[3]]:23),((z-1>=4)?y[x[4]]:59)];fa[z]=ca.value;if(z===w.PERIODS.indexOf('month')){fa[z]--;fa[z+1]=this._daysInMonth(fa[0],fa[1]);}var ga=r(fa),ha=(ea>this._maxtime),ia=(ga<this._mintime),ja=(z===w.PERIODS.indexOf('day')&&ca.value>this._daysInCurrentMonth());if(ia||ha||ja){if(ca.selected){ca.selected=false;this._resetMenu(z);}k.remove(ca);if(ha||ja){this._savedPeriodsBack[z].push(ca);}else this._savedPeriodsFront[z].push(ca);}else ba++;}}};w.getInstance=function(x){"use strict";return x?j.get(x,'datepicker'):null;};n(w,{PERIODS:['year','month','day','hour','minute']});e.exports=w;},null);
__d("PhotosBulkEditablePhoto",["Arbiter","AsyncDialog","AsyncRequest","AsyncResponse","CSS","Dialog","DOM","Event","Focus","Form","Input","Parent","PhotosConst","PlaceUtils","ProgressiveDatepicker","csx","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){var y=null,z=null,aa=false;function ba(ca,da,ea,fa,ga,ha,ia){"use strict";this._root=ca;this._mentionsTypeahead=da;this._placesTypeahead=ea;this._photoData=fa;this._hasOwnPlaceValue=!!ea.getCore().getHiddenValue();var ja=m.find(ca,'.placesInput'),ka=m.find(ca,'.captionTextarea'),la=m.find(ea.element,'.uiTypeaheadCloseButton');this._metadataInputs=m.find(ca,'.metadataInputs');this._editorId=ga;this._published=ha;this._showMove=ia;this._photoDataKey=this._root.id;this._hasTimeTaken=!!this._photoData.timeTaken;this._hasExistingDateValue=this._photoData.isBackdated||this._photoData.hasDerivedDateFromAlbum;this._listeners=[n.listen(ca,'click',this._handleClick.bind(this)),n.listen(ja,'focus',this._placesFocus.bind(this)),n.listen(ka,'focus',this._captionFocus.bind(this)),n.listen(ka,'blur',this._save.bind(this)),n.listen(la,'click',function(){setTimeout(this._save.bind(this),0);}.bind(this)),n.listen(ca,'submit',function(){return false;})];this._previousSaveData=p.serialize(this._root);var ma=m.scry(this._root,'div.backdateInput .periodMenu');for(var na=0;na<ma.length;na++){var oa=ma[na];this._listeners.push(n.listen(oa,'change',function(){return this._saveDate();}.bind(this)));}var pa=m.scry(this._root,"._2sfm").pop();if(pa){var qa=pa.getAttribute('data-direction');this._listeners.push(n.listen(pa,'click',this._rotate.bind(this,qa)));}var ra=m.scry(ca,'.photoContextualSelector')[0];if(ra){var sa=m.scry(ra,'.moveAlbum')[0];sa&&this._listeners.push(n.listen(sa,'click',this._move.bind(this)));var ta=m.scry(ra,'.albumCover')[0];ta&&this._listeners.push(n.listen(ta,'click',this._setAlbumCover.bind(this)));var ua=m.scry(ra,'.removePhoto')[0];ua&&this._listeners.push(n.listen(ua,'click',this.remove.bind(this)));}else{var va=m.find(ca,'.removePhotoButton');this._listeners.push(n.listen(va,'click',this.remove.bind(this)));}this._placesDataListener=[ea.subscribe(['select','reset','render'],function(wa,xa){k.conditionClass(this._root,'focusedInput',(wa=='render'));if(wa=='render')return;if(wa=='reset'&&ea.getCore().getHiddenValue())return;if(xa&&xa.selected){y=xa.selected;if(z==y.text){aa=true;}else{z=y.text;aa=false;}}else{y=null;z=null;aa=false;}this._hasOwnPlaceValue=(wa=='select');k.conditionClass(m.find(ca,'.placeIcon'),'hasPlace',this._hasOwnPlaceValue);if(this._hasOwnPlaceValue)this._save();}.bind(this))];this._placesInputBlurListener=ea.getCore().subscribe('blur',function(wa,xa){k.removeClass(this._root,'focusedInput');}.bind(this));g.inform(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.INITIALIZED'),this,g.BEHAVIOR_PERSISTENT);}ba.prototype.getPhotoDataKey=function(){"use strict";return this._photoDataKey;};ba.prototype.getPhotoData=function(){"use strict";return this._photoData;};ba.prototype.getRoot=function(){"use strict";return this._root;};ba.prototype.getDragHandle=function(){"use strict";return this.getRoot();};ba.prototype.getRotateButtonType=function(){"use strict";return this._rotateButtonType;};ba.prototype.swapData=function(ca,da){"use strict";var ea=this._mentionsTypeahead.getData(),fa=this._placesTypeahead.getData();if(ea!==ca)this._mentionsTypeahead.swapData(ca);if(fa!==da){var ga=this._placesTypeahead.getCore().getValue(),ha=this._placesTypeahead.getCore().getHiddenValue();this._placesTypeahead.swapData(da);if(this.hasOwnPlaceValue())this._placesTypeahead.getCore().select({text:ga,uid:ha});}};ba.prototype.hasOwnPlaceValue=function(){"use strict";return this._hasOwnPlaceValue;};ba.prototype.setAlbumPlace=function(ca,da){"use strict";this._hasOwnPlaceValue=false;var ea=this._placesTypeahead.getCore();k.conditionClass(m.find(this._root,'.placeIcon'),'hasPlace',!!ca);if(ca){ea.select(ca);}else ea.reset();if(!da)this._save();};ba.prototype.addPlaceSelectHandler=function(ca){"use strict";this._placesDataListener.push(this._placesTypeahead.subscribe('select',ca));};ba.prototype.mapEventNameToNamespace=function(ca){"use strict";return ca+(this._editorId?'/'+this._editorId:'');};ba.prototype.setDate=function(ca,da){"use strict";if(this._hasExistingDateValue)return;var ea=!ca,fa=ca;if(ea){if(!this._hasTimeTaken)return;fa=Math.round(this._photoData.timeTaken/600)*600*1000;}var ga=m.find(this.getRoot(),'.uiProgressiveDatepicker'),ha=u.getInstance(ga);ha.setDateWithTimestamp(fa);k.conditionClass(m.find(this._root,'.dateIcon'),'hasDate',!!fa);if(ea)this._saveDate(da);};ba.prototype._doRemove=function(){"use strict";m.remove(this._root);this._unsubscribeAll();g.inform(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.REMOVED'),this);};ba.prototype._unsubscribeAll=function(){"use strict";this._listeners.forEach(function(ca){ca.remove();});this._listeners=[];this._placesDataListener.forEach(function(ca){this._placesTypeahead.unsubscribe(ca);}.bind(this));this._placesTypeahead.getCore().unsubscribe(this._placesInputBlurListener);};ba.prototype._handleClick=function(ca){"use strict";var da=ca.getTarget();if(r.byClass(da,'confirmPhotoBackdate')){this._saveDate();return;}if(!r.byClass(da,'metaIcon'))return;k.addClass(this._root,'showControls');if(r.byClass(da,'placeIcon')){this._showMetadataInput('place');o.set(this._placesTypeahead.getCore().getElement());}else if(r.byClass(da,'dateIcon')){this._showMetadataInput('date');}else if(r.byClass(da,'peopleIcon')){g.inform(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.TAG_BUTTON_CLICKED'),this);this._showMetadataInput('people');}else k.removeClass(this._root,'showControls');};ba.prototype.hideMetadataInputs=function(){"use strict";this._showMetadataInput();};ba.prototype._showMetadataInput=function(ca){"use strict";['people','date','place'].forEach(function(da){k.conditionClass(this._metadataInputs,da,ca==da);}.bind(this));};ba.prototype._captionFocus=function(ca){"use strict";this.hideMetadataInputs();k.addClass(this._root,'focusedInput');};ba.prototype.remove=function(){"use strict";var ca={fbid:this._photoData.fbid,version:s.BULK_EDITOR,confirmed:true};new l().setTitle("Delete Photo").setBody("Are you sure you want to delete this photo?").setButtons(l.OK_AND_CANCEL).setModal(true).setHandler(function(){k.addClass(this._root,'editablePhotoWillBeRemoved');new i().setURI('/ajax/photos/photo/delete/dialog.php').setData(ca).setHandler(function(da){if(da.getPayload().success){this._doRemove();}else k.removeClass(this._root,'editablePhotoWillBeRemoved');}.bind(this)).setErrorHandler(function(da){k.removeClass(this._root,'editablePhotoWillBeRemoved');j.defaultErrorHandler(da);}.bind(this)).send();}.bind(this)).show();};ba.prototype._setAlbumCover=function(){"use strict";var ca={aid:this._photoData.aid,albumFBID:this._photoData.albumFBID,fbid:this._photoData.fbid,owner:this._photoData.owner,pid:this._photoData.pid},da=new i().setURI('/ajax/photos/album/setcover/').setData(ca).setAllowCrossPageTransition(false);h.send(da);};ba.prototype._move=function(){"use strict";var ca={aid:this._photoData.aid,albumFBID:this._photoData.albumFBID,datakey:this._photoDataKey,fbid:this._photoData.fbid,owner:this._photoData.owner,pid:this._photoData.pid},da=new i().setURI('/ajax/photos/photo/move/dialog.php').setData(ca).setAllowCrossPageTransition(false);h.send(da);};ba.prototype._timeclose=function(ca,da){"use strict";ca=ca||0;da=da||0;return Math.abs(ca-da)<43200;};ba.prototype._placesFocus=function(ca){"use strict";k.addClass(this._root,'focusedInput');var da=m.scry(this._root,'input.latitude')[0],ea=m.scry(this._root,'input.longitude')[0],fa=m.scry(this._root,'input.takentime')[0],ga=fa?q.getValue(fa):null,ha=this._placesTypeahead.getData(),ia=ha.getBootstrapData(),ja={};if(da&&ea){ja={latitude:q.getValue(da),longitude:q.getValue(ea),proximity_boost:'true',city_id:null,search_time:ga};ha.setQueryData(ja,false);if(!t.placesClose(ia.latitude,ia.longitude,ja.latitude,ja.longitude)||!this._timeclose(ia.search_time,ja.search_time))ha.setBootstrapData(ja,false).setBootstrapEndpoint(ha.getQueryEndpoint());}else{ja={latitude:null,longitude:null,proximity_boost:null,city_id:null,search_time:ga};if(y)if(y.city_id){ja.city_id=y.city_id;}else if(y.latitude&&y.longitude){ja.latitude=y.latitude;ja.longitude=y.longitude;}ha.setQueryData(ja,false);if(!aa){ha.setBootstrapData(ja).resetBootstrapEndpoint(true);}else if(!t.placesClose(ia.latitude,ia.longitude,ja.latitude,ja.longitude)||!this._timeclose(ia.search_time,ja.search_time))ha.setBootstrapData(ja,false).resetBootstrapEndpoint();}};ba.prototype._saveDate=function(ca){"use strict";var da=m.find(this._root,'div.backdateInput'),ea=p.serialize(da);ea.source=this.source;ea.fbid=this._photoData.fbid;ea.version=s.BULK_EDITOR;ea.bulk=!!ca;k.addClass(da,'backdating');new i().setURI('/ajax/photos/photo/backdate/').setData(ea).setRelativeTo(this._root).send();};ba.prototype._save=function(){"use strict";k.removeClass(this._root,'focusedInput');var ca=p.serialize(this._root);if(this._previousSaveData){var da=false;for(var ea in ca){if(ea!=='caption'&&ea!=='location'&&ea!=='location_data')continue;if(ca[ea]!==this._previousSaveData[ea]){da=true;this._previousSaveData[ea]=ca[ea];}}if(!da)return;}ca.source=this.source;ca.bulk=!this._hasOwnPlaceValue;new i().setURI('/ajax/photos/metadata/save/').setData(ca).setAllowCrossPageTransition(true).send();};ba.prototype._setLoadingIndicator=function(ca){"use strict";k.conditionClass(this._root,"_2sfl",ca);};ba.prototype._rotate=function(ca){"use strict";var da={fbid:this._photoData.fbid,cs_ver:s.BULK_EDITOR,editor_id:this._editorId,published:this._published,showMove:this._showMove};da[ca]=1;this._setLoadingIndicator(true);new i('/ajax/photos/photo/rotate/').setData(da).setHandler(function(ea){m.replace(this._root,ea.getPayload());this._unsubscribeAll();g.inform(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.ROTATED'),this);}.bind(this)).setFinallyHandler(function(){this._setLoadingIndicator(false);}.bind(this)).setMethod('POST').send();return false;};e.exports=ba;},null);
__d("PhotosBulkEditablePhotoPlaceholder",["CSS","DOM","Event","csx","mixInEventEmitter"],function(a,b,c,d,e,f,g,h,i,j,k){function l(m,n,o){"use strict";this._root=m;this._progressBar=n;this._uploadID=o;this._initAndGetGatedButton("._3273",'cancelButtonClicked');this._retryButton=this._initAndGetGatedButton("._3p03",'retryButtonClicked');this._errorOkayButton=this._initAndGetGatedButton("._8qx",'dismissPlaceholder');this._errorCloseButton=this._initAndGetGatedButton("._8qy",'dismissPlaceholder');}l.prototype._initAndGetGatedButton=function(m,n){"use strict";var o=h.scry(this._root,m);if(o.length){o=o[0];i.listen(o,'click',function(){return this.emit(n,this._uploadID);}.bind(this));return o;}};l.prototype.getProgressBar=function(){"use strict";return this._progressBar;};l.prototype.getRoot=function(){"use strict";return this._root;};l.prototype.hide=function(){"use strict";g.hide(this._root);};l.prototype.show=function(){"use strict";g.show(this._root);};l.prototype.showRetryButton=function(){"use strict";this._retryButton&&g.show(this._retryButton);};l.prototype.showErrorOkayButton=function(){"use strict";this._errorOkayButton&&g.show(this._errorOkayButton);};l.prototype.showErrorCloseButton=function(){"use strict";this._errorCloseButton&&g.show(this._errorCloseButton);};k(l,{cancelButtonClicked:true,retryButtonClicked:true,dismissPlaceholder:true});e.exports=l;},null);
__d("XPhotoBatchEditLocationControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b("XControllerURIBuilder").create("\/photos\/edit\/batch\/location\/",{});},null);
__d("PhotosBulkEditor",["ActorURI","Arbiter","AsyncRequest","Button","CSS","DOM","Event","PageTransitions","Parent","PhotosConst","SortableGroup","xuiglyph","XPhotoBatchEditLocationControllerURIBuilder","mapObject","createIxElement","cx","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){var x={ASCENDING:'ascending',DESCENDING:'descending',MANUAL:'manual'},y={ascending:r({name:'triangle-up',shade:'dark',size:'small'}),descending:r({name:'triangle-down',shade:'dark',size:'small'})};function z(aa,ba,ca,da,ea,fa,ga,ha,ia){"use strict";this.source=aa;if(!ba)return;this._root=ba;this._reorderButton=l.scry(this._root.parentNode,'button.reorderButton').pop();this._id=ba.getAttribute('id');this._ownerID=ia;this._photos={};this._tagger=null;this._options=ga;this._isNamespaced=ha;this._placeholder=ea;this._waitingTemplate=fa;this._mentionsData=ca;this._placesData=da;this._albumPlace=null;this._userDate=null;this._useDateFromFile=false;this._albumCoverListeners={};this._albumCoverTracksFirstPhoto=(this.source===p.FLASH_UPLOADER);this._coverPhotoSortingID=null;if(ga.canReorder)this._initSorting(ga.autosaveReorder);var ja=[h.subscribe(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.INITIALIZED'),this._registerPhoto.bind(this)),h.subscribe([this.mapEventNameToNamespace('PhotosBulkEditablePhoto.REMOVED'),this.mapEventNameToNamespace('PhotosBulkEditablePhoto.ROTATED')],function(ka,la){if(this._sortableGroup){var ma=la.getPhotoData().fbid;this._sortableGroup.removeSortable(ma);}delete this._photos[la.getPhotoDataKey()];}.bind(this)),h.subscribe('PhotosBulkEditor.AUTO_ORDER',this._autoOrder.bind(this)),h.subscribe('PhotosBulkBackdateEditor.SAVED',function(ka,la){this._useDateFromFile=la.useDateFromFile;this._userDate=la.backdatedDate;this._setDate();}.bind(this)),h.subscribe(['PhotoAlbumPlacesTypeahead.SELECTED_PLACE','PhotoAlbumPlacesTypeahead.EXIST_PLACE','PhotoAlbumPlacesTypeahead.RESET_PLACE'],this._setPlace.bind(this)),h.subscribe('PhotosBulkEditablePhoto.MOVED',function(ka,la){if(this.getPhotoData(la))this._photos[la]._doRemove();}.bind(this))];m.listen(this._root,'click',function(ka){var la=o.byClass(ka.getTarget(),'editablePhoto'),ma=this._photos;l.scry(this._root,'.showControls').forEach(function(na){if(la!==na){k.removeClass(na,'showControls');ma[na.id].hideMetadataInputs();}});}.bind(this));n.registerHandler(function(){ja.forEach(function(ka){ka.unsubscribe();});if(this._tagger)this._tagger.done();}.bind(this));}z.prototype.init=function(aa,ba,ca,da,ea,fa){"use strict";z.call(this,this.source,aa,ba,ca,da,ea,fa);};z.prototype.getRoot=function(){"use strict";return this._root;};z.prototype.getSourceString=function(){"use strict";if(this.source===p.BULK_EDITOR){return 'bulk_editor';}else if(this.source===p.FLASH_UPLOADER){return 'flash_uploader';}else return null;};z.prototype.isNamespaced=function(){"use strict";return this._isNamespaced;};z.prototype.getVersionConst=function(){"use strict";return this.source;};z.prototype.getViewerSource=function(){"use strict";return null;};z.prototype.getViewerSet=function(){"use strict";return null;};z.prototype.registerTagger=function(aa){"use strict";this._tagger=aa;};z.prototype.needTaggingData=function(){"use strict";return this._tagger&&this._tagger.needTaggingData();};z.prototype.getPhotoData=function(aa){"use strict";var ba=this._photos[aa];if(ba)return ba.getPhotoData();return {};};z.prototype.getPlaceholder=function(){"use strict";return this._placeholder;};z.prototype.getWaitingTemplate=function(){"use strict";return this._waitingTemplate;};z.prototype.addFaceboxes=function(aa){"use strict";this._tagger&&this._tagger.addFaceboxes(aa);};z.prototype.mapEventNameToNamespace=function(aa){"use strict";return aa+(this._isNamespaced?'/'+this._id:'');};z.prototype._registerPhoto=function(event,aa){"use strict";this._setSortMode(x.MANUAL);this._photos[aa.getPhotoDataKey()]=aa;aa.source=this.source;var ba=aa.getPhotoData(),ca=ba.fbid;if(this._sortableGroup)this._sortableGroup.addSortable(ca,aa.getRoot(),aa.getDragHandle());aa.swapData(this._mentionsData,this._placesData);if(this._sortableGroup)aa.addPlaceSelectHandler(function(){this._sortableGroup.killDrag(ca);}.bind(this));if(this._albumPlace&&!aa.hasOwnPlaceValue())aa.setAlbumPlace(this._albumPlace);if(this._sortableGroup&&this._albumCoverTracksFirstPhoto)this._coverPhotoSortingID=this._sortableGroup.getOrder()[0];};z.prototype._recoverPhotos=function(aa){"use strict";var ba=this._photos;for(var ca in ba){var da=ba[ca];this._tagger.recoverPhoto(da);k.addClass(da.getRoot(),'showRecognitionBoxes');var ea=l.find(da.getRoot(),'div.uiScaledImageContainer.scaledImage');this.addFaceboxes(ea);}};z.prototype._initSorting=function(aa){"use strict";this._setSortMode(x.MANUAL);this._dropCallback=function(ba,ca,da){var ea=this._photos[ca.id].getPhotoData(),fa={order:this._sortableGroup.getOrder(),owner:ea.owner};if(aa){var ga;if(ea.set){fa.set=ea.set;ga='/ajax/photos/sets/static/reorder.php';}else{fa.album_fbid=ea.albumFBID;ga='/ajax/photos/reorder.php';}new i(ga).setData(fa).send();}if(this._sortableGroup&&this._albumCoverTracksFirstPhoto&&this._coverPhotoSortingID!==fa.order[0]){var ha=this._photos[this._sortableGroup.sortables[fa.order[0]].id];if(ha)this._makeAlbumCover(ha);this._coverPhotoSortingID=fa.order[0];}if(!da)this._setSortMode(x.MANUAL);}.bind(this);this._sortableGroup=new q().setDropCallback(this._dropCallback).setBeforeGrabCallback(function(){h.inform(this.mapEventNameToNamespace('PhotosBulkEditor.PHOTO_REORDER_START'));}.bind(this));};z.prototype._compare=function(aa,ba){"use strict";switch(this._sortMode){case x.MANUAL:return this._orderLookup[aa.fbid]<this._orderLookup[ba.fbid];case x.ASCENDING:return aa.timeTaken<ba.timeTaken;case x.DESCENDING:return aa.timeTaken>ba.timeTaken;default:throw new Error('Invalid sort mode');}};z.prototype._setSortMode=function(aa){"use strict";if(!this._reorderButton)return;this._sortMode=aa;var ba=null,ca=(aa!==x.MANUAL);if(ca){ba=u(y[aa]);k.addClass(ba,"_3-8_");}j.setDepressed(this._reorderButton,ca);j.setIcon(this._reorderButton,ba);};z.prototype._autoOrder=function(){"use strict";switch(this._sortMode){case x.MANUAL:var aa,ba,ca=this.getOrder();this._orderLookup={};for(ba=0;ba<ca.length;ba++){aa=ca[ba];this._orderLookup[aa]=ba;}this._setSortMode(x.ASCENDING);break;case x.ASCENDING:this._setSortMode(x.DESCENDING);break;case x.DESCENDING:this._setSortMode(x.MANUAL);break;default:throw new Error('Invalid sort mode');}var da=this._sortableGroup.getOrder().map(function(la){return this._photos['editablePhoto_'+la].getPhotoData();}.bind(this));this._sortableGroup.setDropCallback(w);var ea,fa,ga;for(ea=0;ea<da.length;ea++){fa=ea;for(ga=ea+1;ga<da.length;ga++)if(this._compare(da[ga],da[fa]))fa=ga;if(ea!==fa){var ha=da[fa].fbid,ia=da[ea].fbid;this._sortableGroup.dragOverHandler(ia,ha);this._sortableGroup.dropHandler(ha);da.splice(ea,0,da.splice(fa,1)[0]);}}var ja=Object.keys(this._photos)[0],ka=this._photos[ja];this._dropCallback(ka.getPhotoData().fbid,ka.getRoot(),true);this._sortableGroup.setDropCallback(this._dropCallback);};z.prototype._saveCurrentOrder=function(){"use strict";if(this._photos.length===0)return;var aa=this._sortableGroup.getOrder()[0],ba=(this._photos['editablePhoto_'+aa]||this._photos['photoContainer_'+aa]);if(!ba)return;var ca=ba.getPhotoData();if(!ca.albumFBID)return;var da={order:this._sortableGroup.getOrder(),owner:ca.owner,album_fbid:ca.albumFBID};new i('/ajax/photos/reorder.php').setData(da).send();};z.prototype._setPlace=function(event,aa){"use strict";this._albumPlace=aa||null;var ba=this._options.batchUpdateLocation,ca=[];t(this._photos,function(ea,fa){if(ea.hasOwnPlaceValue())return;ea.setAlbumPlace(this._albumPlace,ba);if(ba)ca.push(ea.getPhotoData().fbid);},this);if(ba){var da=new s().getURI();if(this._ownerID)da=g.create(da,this._ownerID);new i(da).setData({photo_ids:ca,location:this._albumPlace?this._albumPlace.text:'',location_data:this._albumPlace?this._albumPlace.uid:0}).send();}};z.prototype._setDate=function(){"use strict";var aa='',ba=null,ca;for(var da in this._photos){ca=this._photos[da];if(!this._useDateFromFile){aa=this._userDate.month+'/'+this._userDate.day+'/'+this._userDate.year;ba=new Date(aa).getTime();}ca.setDate(ba,true);}};z.prototype._showAlbumCoverSet=function(aa){"use strict";if(this._albumCover)k.removeClass(this._albumCover,"checked");var ba=l.find(aa.getRoot(),'.albumCover');k.addClass(ba,"checked");this._albumCover=ba;};z.prototype._makeAlbumCover=function(aa){"use strict";new i().setURI('/ajax/photos/album/setcover').setData(aa.getPhotoData()).send();};z.prototype.getOrder=function(){"use strict";if(this._sortableGroup){return this._sortableGroup.getOrder();}else return [];};z.prototype.hasOrder=function(){"use strict";return !!this._sortableGroup;};e.exports=z;},null);
__d("PhotosBulkHeader",["Arbiter","AsyncRequest","DOM","Event","Form","Run","areJSONRepresentationsEqual","goURI","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(q,r,s,t){"use strict";this._form=q;this._isAlbum=r;this._editable=s;this._audience=t;this._backdatedTime=null;this._initialData=null;g.subscribe('PhotosBulkBackdateEditor.SAVED',function(u,v){if(!i.contains(this._form.getRoot(),v.context))return;this._backdatedTime=v.backdatedDate;}.bind(this));l.onBeforeUnload(function(){if(this.isDataDirty())return "Some of your changes have not been saved. Would you like to save your changes now?";return false;}.bind(this));this._initialData=this.getSerializedData();}p.prototype.getSerializedData=function(){"use strict";var q=k.serialize(this._form.getRoot());if(this._backdatedTime)q.backTime=this._backdatedTime;return q;};p.prototype.isDataDirty=function(){"use strict";return !m(this._initialData,this.getSerializedData());};p.prototype.save=function(q){"use strict";if(!this._editable)return q.call();if(this._audience&&this._audience.removeHiddenPrivacyWidget)this._audience.removeHiddenPrivacyWidget();var r=this._isAlbum?'/ajax/photos/album/edit':'/ajax/photos/sets/edit',s=k.serialize(this._form.getRoot());if(this._backdatedTime)s.backdated_time=this._backdatedTime;new h(r).setData(s).setMethod('POST').setHandler(function(){this._initialData=this.getSerializedData();q();}.bind(this)).send();};p.doneButtonSaveHandler=function(q,r,s){"use strict";var t=q.save.bind(q,function(){n(r);return true;});q._listeners=[j.listen(s,'click',t)];};e.exports=p;},null);